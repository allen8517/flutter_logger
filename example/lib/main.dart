import 'package:flutter/material.dart';
import 'package:flutter_logger/flutter_logger.dart';
import 'package:flutter_logger_example/web_safe_test.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Logger Á§∫‰æã',
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
        useMaterial3: true,
      ),
      home: const LoggerExamplePage(),
    );
  }
}

class LoggerExamplePage extends StatefulWidget {
  const LoggerExamplePage({super.key});

  @override
  State<LoggerExamplePage> createState() => _LoggerExamplePageState();
}

class _LoggerExamplePageState extends State<LoggerExamplePage> {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
        title: const Text('Flutter Logger Á§∫‰æã'),
      ),
      body: const LoggerExampleContent(),
    );
  }
}

class LoggerExampleContent extends StatefulWidget {
  const LoggerExampleContent({super.key});

  @override
  State<LoggerExampleContent> createState() => _LoggerExampleContentState();
}

class _LoggerExampleContentState extends State<LoggerExampleContent> {
  late FlutterLogger logger;
  final List<String> logMessages = [];

  @override
  void initState() {
    super.initState();
    _initializeLogger();
  }

  void _initializeLogger() {
    // ÂàùÂßãÂåñÊó•ÂøóÈÖçÁΩÆ
    final config = LogConfig(
      tag: 'example_app',
      enableFile: true,
      enableConsole: true,
      fileLevels: {
        LogLevel.error,
        LogLevel.debug,
        LogLevel.info,
        LogLevel.warn
      },
      retainDays: 7,
    );

    logger = FlutterLogger.init(config);

    // ËÆ∞ÂΩïÂ∫îÁî®ÂêØÂä®Êó•Âøó
    logger.info('APP', 'Â∫îÁî®ÂêØÂä®ÊàêÂäü');
    _addLogMessage('Â∫îÁî®ÂêØÂä®ÊàêÂäü');
  }

  void _addLogMessage(String message) {
    setState(() {
      logMessages
          .add('${DateTime.now().toString().substring(11, 19)}: $message');
      if (logMessages.length > 10) {
        logMessages.removeAt(0);
      }
    });
  }

  void _logInfo() {
    logger.info('USER_ACTION', 'Áî®Êà∑ÁÇπÂáª‰∫Ü‰ø°ÊÅØÊó•ÂøóÊåâÈíÆ');
    _addLogMessage('üìù ‰ø°ÊÅØÊó•ÂøóÂ∑≤ËÆ∞ÂΩï');
  }

  void _logDebug() {
    logger.debug(
        'DEBUG', 'Ë∞ÉËØï‰ø°ÊÅØÔºöÂΩìÂâçÊó∂Èó¥Êà≥ ${DateTime.now().millisecondsSinceEpoch}');
    _addLogMessage('üêõ Ë∞ÉËØïÊó•ÂøóÂ∑≤ËÆ∞ÂΩï');
  }

  void _logWarning() {
    logger.warn('WARNING', 'Ë≠¶ÂëäÔºöÁî®Êà∑Êìç‰ΩúÂèØËÉΩÂ≠òÂú®ÈóÆÈ¢ò');
    _addLogMessage('‚ö†Ô∏è Ë≠¶ÂëäÊó•ÂøóÂ∑≤ËÆ∞ÂΩï');
  }

  void _logError() {
    try {
      // Ê®°Êãü‰∏Ä‰∏™ÈîôËØØ
      throw Exception('ËøôÊòØ‰∏Ä‰∏™Ê®°ÊãüÁöÑÈîôËØØ');
    } catch (e) {
      logger.error('ERROR', 'ÊçïËé∑Âà∞ÈîôËØØ: $e');
      _addLogMessage('‚ùå ÈîôËØØÊó•ÂøóÂ∑≤ËÆ∞ÂΩï');
    }
  }

  void _simulateNetworkRequest() async {
    logger.info('NETWORK', 'ÂºÄÂßãÁΩëÁªúËØ∑Ê±Ç');
    _addLogMessage('üåê ÂºÄÂßãÁΩëÁªúËØ∑Ê±Ç');

    await Future.delayed(const Duration(seconds: 2));

    logger.info('NETWORK', 'ÁΩëÁªúËØ∑Ê±ÇÂÆåÊàê');
    _addLogMessage('‚úÖ ÁΩëÁªúËØ∑Ê±ÇÂÆåÊàê');
  }

  void _shareLogs() async {
    try {
      // ÂàÜ‰∫´‰ªäÂ§©ÁöÑÊó•ÂøóÊñá‰ª∂
      await logger.shareTodayLogs(title: 'Â∫îÁî®Êó•ÂøóÊñá‰ª∂');
      _addLogMessage('üì§ Êó•ÂøóÂàÜ‰∫´ÂäüËÉΩÂ∑≤Ë∞ÉÁî®');
    } catch (e) {
      logger.error('SHARE', 'ÂàÜ‰∫´Êó•ÂøóÂ§±Ë¥•: $e');
      _addLogMessage('‚ùå ÂàÜ‰∫´Êó•ÂøóÂ§±Ë¥•');
    }
  }

  void _shareAllLogs() async {
    try {
      // ÂàÜ‰∫´ÊâÄÊúâÊó•ÂøóÊñá‰ª∂
      await logger.shareAllLogs(title: 'ÊâÄÊúâÊó•ÂøóÊñá‰ª∂');
      _addLogMessage('üì§ ÊâÄÊúâÊó•ÂøóÂàÜ‰∫´ÂäüËÉΩÂ∑≤Ë∞ÉÁî®');
    } catch (e) {
      logger.error('SHARE', 'ÂàÜ‰∫´ÊâÄÊúâÊó•ÂøóÂ§±Ë¥•: $e');
      _addLogMessage('‚ùå ÂàÜ‰∫´ÊâÄÊúâÊó•ÂøóÂ§±Ë¥•');
    }
  }

  void _uploadLogs() async {
    try {
      // logger.uploader.upload(); // Ê≤°ÊúâuploadÊñπÊ≥ïÔºåÊöÇÊó∂Ê≥®ÈáäÊéâ
      _addLogMessage('‚òÅÔ∏è Êó•Âøó‰∏ä‰º†ÂäüËÉΩÂ∑≤Ë∞ÉÁî®');
    } catch (e) {
      logger.error('UPLOAD', '‰∏ä‰º†Êó•ÂøóÂ§±Ë¥•: $e');
      _addLogMessage('‚ùå ‰∏ä‰º†Êó•ÂøóÂ§±Ë¥•');
    }
  }

  void _getLogFiles() async {
    final files = await logger.getLogFiles();
    _addLogMessage('üìÅ ÊâæÂà∞ ${files.length} ‰∏™Êó•ÂøóÊñá‰ª∂:');
    for (final file in files) {
      _addLogMessage('üìÑ ${file.path}');
    }
  }

  void _getLogFile(DateTime date) async {
    final file = await logger.getLogFile(date);
    if (file != null) {
      _addLogMessage('üìÑ ${file.path}');
    } else {
      _addLogMessage('‚ùå Êó•ÂøóÊñá‰ª∂‰∏çÂ≠òÂú®');
    }
  }

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.stretch,
        children: [
          // Êó•ÂøóÁ∫ßÂà´ÊåâÈíÆ
          Card(
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  const Text(
                    'Êó•ÂøóÁ∫ßÂà´',
                    style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                  ),
                  const SizedBox(height: 12),
                  Row(
                    children: [
                      Expanded(
                        child: ElevatedButton(
                          onPressed: _logInfo,
                          style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.blue,
                            foregroundColor: Colors.white,
                          ),
                          child: const Text('‰ø°ÊÅØ'),
                        ),
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: ElevatedButton(
                          onPressed: _logDebug,
                          style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.green,
                            foregroundColor: Colors.white,
                          ),
                          child: const Text('Ë∞ÉËØï'),
                        ),
                      ),
                    ],
                  ),
                  const SizedBox(height: 8),
                  Row(
                    children: [
                      Expanded(
                        child: ElevatedButton(
                          onPressed: _logWarning,
                          style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.orange,
                            foregroundColor: Colors.white,
                          ),
                          child: const Text('Ë≠¶Âëä'),
                        ),
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: ElevatedButton(
                          onPressed: _logError,
                          style: ElevatedButton.styleFrom(
                            backgroundColor: Colors.red,
                            foregroundColor: Colors.white,
                          ),
                          child: const Text('ÈîôËØØ'),
                        ),
                      ),
                    ],
                  ),
                ],
              ),
            ),
          ),

          const SizedBox(height: 16),

          // ÂäüËÉΩÊåâÈíÆ
          Card(
            child: Padding(
              padding: const EdgeInsets.all(16.0),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  const Text(
                    'ÂäüËÉΩÊµãËØï',
                    style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                  ),
                  const SizedBox(height: 12),
                  Row(
                    children: [
                      Expanded(
                        child: ElevatedButton.icon(
                          onPressed: () => _getLogFile(DateTime.now()),
                          icon: const Icon(Icons.file_copy),
                          label: const Text('Ëé∑ÂèñÊó•ÂøóÊñá‰ª∂'),
                        ),
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: ElevatedButton.icon(
                          onPressed: _getLogFiles,
                          icon: const Icon(Icons.folder),
                          label: const Text('Ëé∑ÂèñÂÖ®ÈÉ®Êó•ÂøóÊñá‰ª∂'),
                        ),
                      ),
                    ],
                  ),
                  const SizedBox(height: 8),
                  Row(
                    children: [
                      Expanded(
                        child: ElevatedButton.icon(
                          onPressed: _simulateNetworkRequest,
                          icon: const Icon(Icons.network_check),
                          label: const Text('ÁΩëÁªúËØ∑Ê±Ç'),
                        ),
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: ElevatedButton.icon(
                          onPressed: _shareLogs,
                          icon: const Icon(Icons.share),
                          label: const Text('ÂàÜ‰∫´‰ªäÊó•Êó•Âøó'),
                        ),
                      ),
                    ],
                  ),
                  const SizedBox(height: 8),
                  Row(
                    children: [
                      Expanded(
                        child: ElevatedButton.icon(
                          onPressed: _shareAllLogs,
                          icon: const Icon(Icons.folder_shared),
                          label: const Text('ÂàÜ‰∫´ÊâÄÊúâÊó•Âøó'),
                        ),
                      ),
                      const SizedBox(width: 8),
                      Expanded(
                        child: ElevatedButton.icon(
                          onPressed: _uploadLogs,
                          icon: const Icon(Icons.cloud_upload),
                          label: const Text('‰∏ä‰º†Êó•Âøó'),
                        ),
                      ),
                    ],
                  ),
                ],
              ),
            ),
          ),

          const SizedBox(height: 16),

          // Êó•ÂøóÊ∂àÊÅØÊòæÁ§∫
          Expanded(
            child: Card(
              child: Padding(
                padding: const EdgeInsets.all(16.0),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Text(
                      'ÊúÄËøëÊó•ÂøóÊ∂àÊÅØ',
                      style:
                          TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                    ),
                    const SizedBox(height: 12),
                    Expanded(
                      child: Container(
                        padding: const EdgeInsets.all(12),
                        decoration: BoxDecoration(
                          color: Colors.grey[100],
                          borderRadius: BorderRadius.circular(8),
                        ),
                        child: logMessages.isEmpty
                            ? const Center(
                                child: Text(
                                  'ÊöÇÊó†Êó•ÂøóÊ∂àÊÅØ',
                                  style: TextStyle(color: Colors.grey),
                                ),
                              )
                            : ListView.builder(
                                itemCount: logMessages.length,
                                itemBuilder: (context, index) {
                                  return Padding(
                                    padding:
                                        const EdgeInsets.symmetric(vertical: 2),
                                    child: Text(
                                      logMessages[
                                          logMessages.length - 1 - index],
                                      style: const TextStyle(
                                          fontFamily: 'monospace'),
                                    ),
                                  );
                                },
                              ),
                      ),
                    ),
                  ],
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
}
